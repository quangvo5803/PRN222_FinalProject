@model BusinessObject.Model.Order
<div class="container mt-5">
    <h2 class="mb-4">Order Details</h2>
    <div class="row">
        <div class="col-md-6">
            <h4>Order Information</h4>
            <p><strong>Order ID:</strong> @Model.Id</p>
            <p><strong>Order Date:</strong> @Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</p>
            <p><strong>Status:</strong> @Model.Status</p>
            <p><strong>Payment Method:</strong> @Model.PaymentMethod</p>
            <p><strong>Shipping Address:</strong> @Model.ShippingAddress</p>
            <p><strong>Phone Number:</strong> @Model.PhoneNumber</p>

            @foreach (var detail in Model.OrderDetails)
            {
                <div class="card mb-3">
                    <div class="card-body">
                        <h5>@detail.Product.Name</h5>
                        <p>Quantity: @detail.Quantity</p>
                        <p>Price: $@(detail.UnitPrice * detail.Quantity)</p>
                    </div>
                </div>
            }
        </div>
        <div class="col-md-6">
            <h4>Summary</h4>
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <strong>Total Price:</strong>
                        <strong>$@Model.TotalPrice</strong>
                    </div>
                </div>
            </div>
            @if (Model.Status == OrderStatus.Pending)
            {
                <button id="cancelOrder" class="btn btn-danger mt-3" data-order-id="@Model.Id">Cancel Order</button>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('cancelOrder')?.addEventListener('click', async () => {
            const orderId = document.getElementById('cancelOrder').dataset.orderId;
            const confirmCancel = confirm("Bạn có chắc chắn muốn hủy đơn hàng này không?");

            if (confirmCancel) {
                const response = await fetch(`/Customer/CancelOrder?orderId=${orderId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();
                if (result.success) {
                    alert(result.message);
                    location.reload();
                } else {
                    alert(result.message);
                }
            } 
        });

        @if (TempData["success"] != null)
        {
            @:alert('@TempData["success"]');
        }
        else if (TempData["error"] != null)
        {
            @:alert('@TempData["error"]');
        }
    </script>
}